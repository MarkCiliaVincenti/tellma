	CREATE PROCEDURE [bll].[Lines__Pivot]
	@Lines dbo.[LineList] READONLY,
	@Entries dbo.[EntryList] READONLY
AS
	DECLARE @WideLines dbo.WideLineList;

	INSERT INTO @WideLines(
		[Index],
		[DocumentIndex],
		[Id],
		[DefinitionId],
		[PostingDate],
		[TemplateLineId],
		[Multiplier],
		[Memo],
		[Id0],
		[Direction0],
		[AccountId0],
		[CustodianId0],
		[ResourceId0],
		[CenterId0],
		[CurrencyId0],
		[EntryTypeId0],
		[MonetaryValue0],
		[Quantity0],
		[UnitId0],
		[Value0],
		[Time10],
		[Time20],
		[ExternalReference0],
		[AdditionalReference0],
		[NotedRelationId0],
		[NotedAgentName0],
		[NotedAmount0],
		[NotedDate0],
		[Id1],
		[Direction1],
		[AccountId1],
		[CustodianId1],
		[ResourceId1],
		[CenterId1],
		[CurrencyId1],
		[EntryTypeId1],
		[MonetaryValue1],
		[Quantity1],
		[UnitId1],
		[Value1],
		[Time11],
		[Time21],
		[ExternalReference1],
		[AdditionalReference1],
		[NotedRelationId1],
		[NotedAgentName1],
		[NotedAmount1],
		[NotedDate1],
		[Id2],
		[Direction2],
		[AccountId2],
		[CustodianId2],
		[ResourceId2],
		[CenterId2],
		[CurrencyId2],
		[EntryTypeId2],
		[MonetaryValue2],
		[Quantity2],
		[UnitId2],
		[Value2],
		[Time12],
		[Time22],
		[ExternalReference2],
		[AdditionalReference2],
		[NotedRelationId2],
		[NotedAgentName2],
		[NotedAmount2],
		[NotedDate2]
	)
	SELECT
		L.[Index],
		L.[DocumentIndex],
		L.[Id],
		L.[DefinitionId],
		L.[PostingDate],
		L.[TemplateLineId],
		L.[Multiplier],
		L.[Memo],
		E0.[Id],
		E0.[Direction],
		E0.[AccountId],
		E0.[CustodianId],
		E0.[ResourceId],
		E0.[CenterId],
		E0.[CurrencyId],
		E0.[EntryTypeId],
		E0.[MonetaryValue],
		E0.[Quantity],
		E0.[UnitId],
		E0.[Value],
		E0.[Time1],
		E0.[Time2],
		E0.[ExternalReference],
		E0.[AdditionalReference],
		E0.[NotedRelationId],
		E0.[NotedAgentName],
		E0.[NotedAmount],
		E0.[NotedDate],
		E1.[Id],
		E1.[Direction],
		E1.[AccountId],
		E1.[CustodianId],
		E1.[ResourceId],
		E1.[CenterId],
		E1.[CurrencyId],
		E1.[EntryTypeId],
		E1.[MonetaryValue],
		E1.[Quantity],
		E1.[UnitId],
		E1.[Value],
		E1.[Time1],
		E1.[Time2],
		E1.[ExternalReference],
		E1.[AdditionalReference],
		E1.[NotedRelationId],
		E1.[NotedAgentName],
		E1.[NotedAmount],
		E1.[NotedDate],
		E2.[Id],
		E2.[Direction],
		E2.[AccountId],
		E2.[CustodianId],
		E2.[ResourceId],
		E2.[CenterId],
		E2.[CurrencyId],
		E2.[EntryTypeId],
		E2.[MonetaryValue],
		E2.[Quantity],
		E2.[UnitId],
		E2.[Value],
		E2.[Time1],
		E2.[Time2],
		E2.[ExternalReference],
		E2.[AdditionalReference],
		E2.[NotedRelationId],
		E2.[NotedAgentName],
		E2.[NotedAmount],
		E2.[NotedDate]
	FROM @Lines L
	JOIN @Entries E0 ON L.[Index] = E0.[LineIndex] AND L.[DocumentIndex] = E0.[DocumentIndex] AND E0.[Index] = 0
	LEFT JOIN @Entries E1 ON L.[Index] = E1.[LineIndex] AND L.[DocumentIndex] = E1.[DocumentIndex] AND E1.[Index] = 1
	LEFT JOIN @Entries E2 ON L.[Index] = E2.[LineIndex] AND L.[DocumentIndex] = E2.[DocumentIndex] AND E2.[Index] = 2

	SELECT * FROM @WideLines;