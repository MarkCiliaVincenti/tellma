	CREATE PROCEDURE [bll].[Lines__Pivot]
	@Lines dbo.[LineList] READONLY,
	@Entries dbo.[EntryList] READONLY
AS
	DECLARE @WideLines dbo.WideLineList;

	INSERT INTO @WideLines(
		[Index],
		[DocumentIndex],
		[Id],
		[DefinitionId],
		[ResponsibilityCenterId],
		[CurrencyId],
		[AgentId],
		[ResourceId],
		[MonetaryValue],
		[Quantity],
		[UnitId],
		[Value],
		[Memo],
		[Id0],
		[Direction0],
		[AgentId0],
		[ResourceId0],
		[ResponsibilityCenterId0],
		--[AccountIdentifier0],
		--[ResourceIdentifier0],
		[CurrencyId0],
		[EntryTypeId0],
		[DueDate0],
		[MonetaryValue0],
		[Quantity0],
		[UnitId0],
		[Value0],
		[Time10],
		[Time20],
		[ExternalReference0],
		[AdditionalReference0],
		[NotedAgentId0],
		[NotedAgentName0],
		[NotedAmount0],
		[NotedDate0],
		[Id1],
		[Direction1],
		[AgentId1],
		[ResourceId1],
		[ResponsibilityCenterId1],
		--[AccountIdentifier1],
		--[ResourceIdentifier1],
		[CurrencyId1],
		[EntryTypeId1],
		[DueDate1],
		[MonetaryValue1],
		[Quantity1],
		[UnitId1],
		[Value1],
		[Time11],
		[Time21],
		[ExternalReference1],
		[AdditionalReference1],
		[NotedAgentId1],
		[NotedAgentName1],
		[NotedAmount1],
		[NotedDate1],
		[Id2],
		[Direction2],
		[AgentId2],
		[ResourceId2],
		[ResponsibilityCenterId2],
		--[AccountIdentifier2],
		--[ResourceIdentifier2],
		[CurrencyId2],
		[EntryTypeId2],
		[DueDate2],
		[MonetaryValue2],
		[Quantity2],
		[UnitId2],
		[Value2],
		[Time12],
		[Time22],
		[ExternalReference2],
		[AdditionalReference2],
		[NotedAgentId2],
		[NotedAgentName2],
		[NotedAmount2],
		[NotedDate2]
	)
	SELECT
		L.[Index],
		L.[DocumentIndex],
		L.[Id],
		L.[DefinitionId],
		L.[ResponsibilityCenterId],
		L.[CurrencyId],
		L.[AgentId],
		L.[ResourceId],
		L.[MonetaryValue],
		L.[Quantity],
		L.[UnitId],
		L.[Value],
		L.[Memo],
		E0.[Id],
		E0.[Direction],
		E0.[AgentId],
		E0.[ResourceId],
		E0.[ResponsibilityCenterId],
		--E0.[AccountIdentifier],
		--E0.[ResourceIdentifier],
		E0.[CurrencyId],
		E0.[EntryTypeId],
		E0.[DueDate],
		E0.[MonetaryValue],
		E0.[Quantity],
		E0.[UnitId],
		E0.[Value],
		E0.[Time1],
		E0.[Time2],
		E0.[ExternalReference],
		E0.[AdditionalReference],
		E0.[NotedAgentId],
		E0.[NotedAgentName],
		E0.[NotedAmount],
		E0.[NotedDate],
		E1.[Id],
		E1.[Direction],
		E1.[AgentId],
		E1.[ResourceId],
		E1.[ResponsibilityCenterId],
		--E1.[AccountIdentifier],
		--E1.[ResourceIdentifier],
		E1.[CurrencyId],
		E1.[EntryTypeId],
		E1.[DueDate],
		E1.[MonetaryValue],
		E1.[Quantity],
		E1.[UnitId],
		E1.[Value],
		E1.[Time1],
		E1.[Time2],
		E1.[ExternalReference],
		E1.[AdditionalReference],
		E1.[NotedAgentId],
		E1.[NotedAgentName],
		E1.[NotedAmount],
		E1.[NotedDate],
		E2.[Id],
		E2.[Direction],
		E2.[AgentId],
		E2.[ResourceId],
		E2.[ResponsibilityCenterId],
		--E2.[AccountIdentifier],
		--E2.[ResourceIdentifier],
		E2.[CurrencyId],
		E2.[EntryTypeId],
		E2.[DueDate],
		E2.[MonetaryValue],
		E2.[Quantity],
		E2.[UnitId],
		E2.[Value],
		E2.[Time1],
		E2.[Time2],
		E2.[ExternalReference],
		E2.[AdditionalReference],
		E2.[NotedAgentId],
		E2.[NotedAgentName],
		E2.[NotedAmount],
		E2.[NotedDate]
	FROM @Lines L
	JOIN @Entries E0 ON L.[Index] = E0.[LineIndex] AND L.[DocumentIndex] = E0.[DocumentIndex] AND E0.[Index] = 0
	LEFT JOIN @Entries E1 ON L.[Index] = E1.[LineIndex] AND L.[DocumentIndex] = E1.[DocumentIndex] AND E1.[Index] = 1
	LEFT JOIN @Entries E2 ON L.[Index] = E2.[LineIndex] AND L.[DocumentIndex] = E2.[DocumentIndex] AND E2.[Index] = 2

	SELECT * FROM @WideLines;