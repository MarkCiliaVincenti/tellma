	CREATE PROCEDURE [bll].[Lines__Pivot]
	@Lines dbo.[LineList] READONLY,
	@Entries dbo.[EntryList] READONLY
AS
	DECLARE @WideLines dbo.WideLineList;

	INSERT INTO @WideLines(
		[Index],
		[DocumentIndex],
		[Id],
		[DefinitionId],
		[PostingDate],
		[TemplateLineId],
		[Multiplier],
		[Memo],

		[Id0],
		[Direction0],
		[AccountId0],
		[CustodianId0],
		[CustodyId0],
		[ParticipantId0],
		[ResourceId0],
		[CenterId0],
		[CurrencyId0],
		[EntryTypeId0],
		[MonetaryValue0],
		[Quantity0],
		[UnitId0],
		[Value0],
		[Time10],
		[Time20],
		[ExternalReference0],
		[AdditionalReference0],
		[NotedRelationId0],
		[NotedAgentName0],
		[NotedAmount0],
		[NotedDate0],

		[Id1],
		[Direction1],
		[AccountId1],
		[CustodianId1],
		[CustodyId1],
		[ParticipantId1],
		[ResourceId1],
		[CenterId1],
		[CurrencyId1],
		[EntryTypeId1],
		[MonetaryValue1],
		[Quantity1],
		[UnitId1],
		[Value1],
		[Time11],
		[Time21],
		[ExternalReference1],
		[AdditionalReference1],
		[NotedRelationId1],
		[NotedAgentName1],
		[NotedAmount1],
		[NotedDate1],

		[Id2],
		[Direction2],
		[AccountId2],
		[CustodianId2],
		[CustodyId2],
		[ParticipantId2],
		[ResourceId2],
		[CenterId2],
		[CurrencyId2],
		[EntryTypeId2],
		[MonetaryValue2],
		[Quantity2],
		[UnitId2],
		[Value2],
		[Time12],
		[Time22],
		[ExternalReference2],
		[AdditionalReference2],
		[NotedRelationId2],
		[NotedAgentName2],
		[NotedAmount2],
		[NotedDate2],

		[Id3],
		[Direction3],
		[AccountId3],
		[CustodianId3],
		[CustodyId3],
		[ParticipantId3],
		[ResourceId3],
		[CenterId3],
		[CurrencyId3],
		[EntryTypeId3],
		[MonetaryValue3],
		[Quantity3],
		[UnitId3],
		[Value3],
		[Time13],
		[Time23],
		[ExternalReference3],
		[AdditionalReference3],
		[NotedRelationId3],
		[NotedAgentName3],
		[NotedAmount3],
		[NotedDate3],

		[Id4],
		[Direction4],
		[AccountId4],
		[CustodianId4],
		[CustodyId4],
		[ParticipantId4],
		[ResourceId4],
		[CenterId4],
		[CurrencyId4],
		[EntryTypeId4],
		[MonetaryValue4],
		[Quantity4],
		[UnitId4],
		[Value4],
		[Time14],
		[Time24],
		[ExternalReference4],
		[AdditionalReference4],
		[NotedRelationId4],
		[NotedAgentName4],
		[NotedAmount4],
		[NotedDate4],

		[Id5],
		[Direction5],
		[AccountId5],
		[CustodianId5],
		[CustodyId5],
		[ParticipantId5],
		[ResourceId5],
		[CenterId5],
		[CurrencyId5],
		[EntryTypeId5],
		[MonetaryValue5],
		[Quantity5],
		[UnitId5],
		[Value5],
		[Time15],
		[Time25],
		[ExternalReference5],
		[AdditionalReference5],
		[NotedRelationId5],
		[NotedAgentName5],
		[NotedAmount5],
		[NotedDate5],

		[Id6],
		[Direction6],
		[AccountId6],
		[CustodianId6],
		[CustodyId6],
		[ParticipantId6],
		[ResourceId6],
		[CenterId6],
		[CurrencyId6],
		[EntryTypeId6],
		[MonetaryValue6],
		[Quantity6],
		[UnitId6],
		[Value6],
		[Time16],
		[Time26],
		[ExternalReference6],
		[AdditionalReference6],
		[NotedRelationId6],
		[NotedAgentName6],
		[NotedAmount6],
		[NotedDate6],

		[Id7],
		[Direction7],
		[AccountId7],
		[CustodianId7],
		[CustodyId7],
		[ParticipantId7],
		[ResourceId7],
		[CenterId7],
		[CurrencyId7],
		[EntryTypeId7],
		[MonetaryValue7],
		[Quantity7],
		[UnitId7],
		[Value7],
		[Time17],
		[Time27],
		[ExternalReference7],
		[AdditionalReference7],
		[NotedRelationId7],
		[NotedAgentName7],
		[NotedAmount7],
		[NotedDate7]
	)
	SELECT
		L.[Index],
		L.[DocumentIndex],
		L.[Id],
		L.[DefinitionId],
		L.[PostingDate],
		L.[TemplateLineId],
		L.[Multiplier],
		L.[Memo],

		E0.[Id],
		E0.[Direction],
		E0.[AccountId],
		E0.[CustodianId],
		E0.[CustodyId],
		E0.[ParticipantId],
		E0.[ResourceId],
		E0.[CenterId],
		E0.[CurrencyId],
		E0.[EntryTypeId],
		E0.[MonetaryValue],
		E0.[Quantity],
		E0.[UnitId],
		E0.[Value],
		E0.[Time1],
		E0.[Time2],
		E0.[ExternalReference],
		E0.[AdditionalReference],
		E0.[NotedRelationId],
		E0.[NotedAgentName],
		E0.[NotedAmount],
		E0.[NotedDate],

		E1.[Id],
		E1.[Direction],
		E1.[AccountId],
		E1.[CustodianId],
		E1.[CustodyId],
		E1.[ParticipantId],
		E1.[ResourceId],
		E1.[CenterId],
		E1.[CurrencyId],
		E1.[EntryTypeId],
		E1.[MonetaryValue],
		E1.[Quantity],
		E1.[UnitId],
		E1.[Value],
		E1.[Time1],
		E1.[Time2],
		E1.[ExternalReference],
		E1.[AdditionalReference],
		E1.[NotedRelationId],
		E1.[NotedAgentName],
		E1.[NotedAmount],
		E1.[NotedDate],

		E2.[Id],
		E2.[Direction],
		E2.[AccountId],
		E2.[CustodianId],
		E2.[CustodyId],
		E2.[ParticipantId],
		E2.[ResourceId],
		E2.[CenterId],
		E2.[CurrencyId],
		E2.[EntryTypeId],
		E2.[MonetaryValue],
		E2.[Quantity],
		E2.[UnitId],
		E2.[Value],
		E2.[Time1],
		E2.[Time2],
		E2.[ExternalReference],
		E2.[AdditionalReference],
		E2.[NotedRelationId],
		E2.[NotedAgentName],
		E2.[NotedAmount],
		E2.[NotedDate],

		E3.[Id],
		E3.[Direction],
		E3.[AccountId],
		E3.[CustodianId],
		E3.[CustodyId],
		E3.[ParticipantId],
		E3.[ResourceId],
		E3.[CenterId],
		E3.[CurrencyId],
		E3.[EntryTypeId],
		E3.[MonetaryValue],
		E3.[Quantity],
		E3.[UnitId],
		E3.[Value],
		E3.[Time1],
		E3.[Time2],
		E3.[ExternalReference],
		E3.[AdditionalReference],
		E3.[NotedRelationId],
		E3.[NotedAgentName],
		E3.[NotedAmount],
		E3.[NotedDate],

		E4.[Id],
		E4.[Direction],
		E4.[AccountId],
		E4.[CustodianId],
		E4.[CustodyId],
		E4.[ParticipantId],
		E4.[ResourceId],
		E4.[CenterId],
		E4.[CurrencyId],
		E4.[EntryTypeId],
		E4.[MonetaryValue],
		E4.[Quantity],
		E4.[UnitId],
		E4.[Value],
		E4.[Time1],
		E4.[Time2],
		E4.[ExternalReference],
		E4.[AdditionalReference],
		E4.[NotedRelationId],
		E4.[NotedAgentName],
		E4.[NotedAmount],
		E4.[NotedDate],

		E5.[Id],
		E5.[Direction],
		E5.[AccountId],
		E5.[CustodianId],
		E5.[CustodyId],
		E5.[ParticipantId],
		E5.[ResourceId],
		E5.[CenterId],
		E5.[CurrencyId],
		E5.[EntryTypeId],
		E5.[MonetaryValue],
		E5.[Quantity],
		E5.[UnitId],
		E5.[Value],
		E5.[Time1],
		E5.[Time2],
		E5.[ExternalReference],
		E5.[AdditionalReference],
		E5.[NotedRelationId],
		E5.[NotedAgentName],
		E5.[NotedAmount],
		E5.[NotedDate],

		E6.[Id],
		E6.[Direction],
		E6.[AccountId],
		E6.[CustodianId],
		E6.[CustodyId],
		E6.[ParticipantId],
		E6.[ResourceId],
		E6.[CenterId],
		E6.[CurrencyId],
		E6.[EntryTypeId],
		E6.[MonetaryValue],
		E6.[Quantity],
		E6.[UnitId],
		E6.[Value],
		E6.[Time1],
		E6.[Time2],
		E6.[ExternalReference],
		E6.[AdditionalReference],
		E6.[NotedRelationId],
		E6.[NotedAgentName],
		E6.[NotedAmount],
		E6.[NotedDate],

		E7.[Id],
		E7.[Direction],
		E7.[AccountId],
		E7.[CustodianId],
		E7.[CustodyId],
		E7.[ParticipantId],
		E7.[ResourceId],
		E7.[CenterId],
		E7.[CurrencyId],
		E7.[EntryTypeId],
		E7.[MonetaryValue],
		E7.[Quantity],
		E7.[UnitId],
		E7.[Value],
		E7.[Time1],
		E7.[Time2],
		E7.[ExternalReference],
		E7.[AdditionalReference],
		E7.[NotedRelationId],
		E7.[NotedAgentName],
		E7.[NotedAmount],
		E7.[NotedDate]
	FROM @Lines L
	JOIN	  @Entries E0 ON L.[Index] = E0.[LineIndex] AND L.[DocumentIndex] = E0.[DocumentIndex] AND E0.[Index] = 0
	LEFT JOIN @Entries E1 ON L.[Index] = E1.[LineIndex] AND L.[DocumentIndex] = E1.[DocumentIndex] AND E1.[Index] = 1
	LEFT JOIN @Entries E2 ON L.[Index] = E2.[LineIndex] AND L.[DocumentIndex] = E2.[DocumentIndex] AND E2.[Index] = 2
	LEFT JOIN @Entries E3 ON L.[Index] = E3.[LineIndex] AND L.[DocumentIndex] = E3.[DocumentIndex] AND E3.[Index] = 3
	LEFT JOIN @Entries E4 ON L.[Index] = E4.[LineIndex] AND L.[DocumentIndex] = E4.[DocumentIndex] AND E4.[Index] = 4
	LEFT JOIN @Entries E5 ON L.[Index] = E5.[LineIndex] AND L.[DocumentIndex] = E5.[DocumentIndex] AND E5.[Index] = 5
	LEFT JOIN @Entries E6 ON L.[Index] = E6.[LineIndex] AND L.[DocumentIndex] = E6.[DocumentIndex] AND E6.[Index] = 6
	LEFT JOIN @Entries E7 ON L.[Index] = E7.[LineIndex] AND L.[DocumentIndex] = E7.[DocumentIndex] AND E7.[Index] = 7
	SELECT * FROM @WideLines;