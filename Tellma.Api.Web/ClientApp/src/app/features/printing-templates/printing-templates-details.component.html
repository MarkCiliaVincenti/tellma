<t-details collection="PrintingTemplate" [createFunc]="create" [expand]="expand" [mode]="mode"
    [additionalSelect]="additionalSelect" [masterCrumb]="'PrintingTemplates' | translate" [detailsCrumb]="detailsCrumb"
    [idString]="idString" [documentTemplate]="document" layout="full-screen" [actions]="[]" [isInactive]="isInactive"
    theme="dark">
</t-details>

<!-- Details Crumb -->
<ng-template #detailsCrumb let-model="model">
    <span>{{ getMultilingualValue(model, 'Name', ws) }}</span>
</ng-template>

<!-- Edit/View Template -->
<ng-template #document let-model="model" let-isEdit="isEdit">
    <div class="h-100 d-flex">

        <!-- Collapsed Metadata -->
        <div class="p-2 t-dark t-text-whitish t-collapsed-studio-pane t-pointer" *ngIf="isEdit && collapseMetadata"
            (click)="onToggleMetadata()">
            <div class="text-center mb-3">
                <fa-icon icon="angle-right" [flip]="flipIcon(false)"></fa-icon>
            </div>
            <span>{{ 'Metadata' | translate }}
                &nbsp;
                <fa-icon class="t-light-danger mx-1" icon="exclamation" *ngIf="metadataPaneErrors(model)">
                </fa-icon>
            </span>
        </div>

        <!-- Metadata -->
        <div class="t-less-dark h-100 flex-column t-studio-pane" *ngIf="isEdit" [class.d-flex]="!collapseMetadata"
            [class.d-none]="collapseMetadata">

            <!-- Metadata Header -->
            <div class="py-2 px-3 t-dark t-text-whitish d-flex justify-content-between t-pointer"
                (click)="onToggleMetadata()">
                <div>
                    <span>{{ 'Metadata' | translate }}</span>&nbsp;
                    <fa-icon class="t-light-danger mx-1" icon="exclamation" *ngIf="metadataPaneErrors(model)">
                    </fa-icon>
                </div>
                <div class="text-center">
                    <fa-icon icon="angle-left" [flip]="flipIcon(false)"></fa-icon>
                </div>
            </div>

            <!-- Metadata Content -->
            <div class="p-2 t-studio-section flex-wrap overflow-auto">

                <!-- Name -->
                <div class="form-group" [class.is-invalid]="invalid(name, model.serverErrors?.Name)">
                    <label class="small" for="name">{{ ('Name' | translate) + ws.primaryPostfix }}</label>
                    <input class="form-control t-studio-input" id="name" type="text" [(ngModel)]="model.Name"
                        (ngModelChange)="onTemplateChange()" [ngModelOptions]="{ updateOn: 'blur' }" autocomplete="off"
                        #name="ngModel" />
                    <ng-container
                        *ngTemplateOutlet="errorsTemplate;context: { control: name, serverErrors: model.serverErrors?.Name }">
                    </ng-container>
                </div>

                <!-- Name2 -->
                <div class="form-group" [class.is-invalid]="invalid(name2, model.serverErrors?.Name2)"
                    *ngIf="ws.settings?.SecondaryLanguageId">
                    <label class="small" for="name2">{{ ('Name' | translate) + ws.secondaryPostfix }}</label>
                    <input class="form-control t-studio-input" id="name2" type="text" [(ngModel)]="model.Name2"
                        (ngModelChange)="onTemplateChange()" [ngModelOptions]="{ updateOn: 'blur' }" autocomplete="off"
                        #name2="ngModel" />
                    <ng-container
                        *ngTemplateOutlet="errorsTemplate;context: { control: name2, serverErrors: model.serverErrors?.Name2 }">
                    </ng-container>
                </div>

                <!-- Name3 -->
                <div class="form-group" [class.is-invalid]="invalid(name3, model.serverErrors?.Name3)"
                    *ngIf="ws.settings?.TernaryLanguageId">
                    <label class="small" for="name3">{{ ('Name' | translate) + ws.ternaryPostfix }}</label>
                    <input class="form-control t-studio-input" id="name3" type="text" [(ngModel)]="model.Name3"
                        (ngModelChange)="onTemplateChange()" [ngModelOptions]="{ updateOn: 'blur' }" autocomplete="off"
                        #name3="ngModel" />
                    <ng-container
                        *ngTemplateOutlet="errorsTemplate;context: { control: name3, serverErrors: model.serverErrors?.Name3 }">
                    </ng-container>
                </div>

                <!-- Code -->
                <div class="form-group" [class.is-invalid]="invalid(code, model.serverErrors?.Code)">
                    <label class="small" for="code">{{ 'Code' }}</label>
                    <input class="form-control t-studio-input" id="code" type="text" [(ngModel)]="model.Code"
                        #code="ngModel" [ngModelOptions]="{ updateOn: 'blur' }" autocomplete="off" />
                    <ng-container
                        *ngTemplateOutlet="errorsTemplate;context: { control: code, serverErrors: model.serverErrors?.Code }">
                    </ng-container>
                </div>

                <!-- Description -->
                <div class="form-group" [class.is-invalid]="invalid(description, model.serverErrors?.Description)">
                    <label class="small" for="desc">{{ ('Description' | translate) + ws.primaryPostfix }}</label>
                    <textarea class="form-control t-studio-input t-no-resize" rows="3" id="desc" type="text"
                        [(ngModel)]="model.Description" [ngModelOptions]="{ updateOn: 'blur' }"
                        #description="ngModel"></textarea>
                    <ng-container
                        *ngTemplateOutlet="errorsTemplate;context: { control: description, serverErrors: model.serverErrors?.Description }">
                    </ng-container>
                </div>

                <!-- Description2 -->
                <div class="form-group" [class.is-invalid]="invalid(description2, model.serverErrors?.Description2)"
                    *ngIf="ws.settings?.SecondaryLanguageId">
                    <label class="small" for="desc2">{{ ('Description' | translate) + ws.secondaryPostfix }}</label>
                    <textarea class="form-control t-studio-input t-no-resize" rows="3" id="desc2" type="text"
                        [(ngModel)]="model.Description2" [ngModelOptions]="{ updateOn: 'blur' }"
                        #description2="ngModel"></textarea>
                    <ng-container
                        *ngTemplateOutlet="errorsTemplate;context: { control: description2, serverErrors: model.serverErrors?.Description2 }">
                    </ng-container>
                </div>

                <!-- Description3 -->
                <div class="form-group" [class.is-invalid]="invalid(description3, model.serverErrors?.Description3)"
                    *ngIf="ws.settings?.TernaryLanguageId">
                    <label class="small" for="desc3">{{ ('Description' | translate) + ws.ternaryPostfix }}</label>
                    <textarea class="form-control t-studio-input t-no-resize" rows="3" id="desc3" type="text"
                        [(ngModel)]="model.Description3" [ngModelOptions]="{ updateOn: 'blur' }"
                        #description3="ngModel"></textarea>
                    <ng-container
                        *ngTemplateOutlet="errorsTemplate;context: { control: description3, serverErrors: model.serverErrors?.Description3 }">
                    </ng-container>
                </div>

                <!-- Context -->
                <!-- <div class="form-group" [class.is-invalid]="invalid(context, model.serverErrors?.Context)">
                    <label class="small" for="context">{{ 'PrintingTemplate_Context' | translate }} ({{
                        'Visibility_Optional' | translate }})</label>
                    <input class="form-control t-studio-input" id="context" type="text" [(ngModel)]="model.Context"
                        #context="ngModel" (ngModelChange)="onPreviewChange()" [ngModelOptions]="{ updateOn: 'blur' }"
                        autocomplete="off" />
                    <ng-container
                        *ngTemplateOutlet="errorsTemplate;context: { control: context, serverErrors: model.serverErrors?.Context }">
                    </ng-container>
                </div> -->

                <!-- Usage -->
                <div class="form-group" [class.is-invalid]="invalid(usage, model.serverErrors?.Usage)">
                    <label class="small" for="usage">{{ 'Template_Usage' | translate }}</label>
                    <select class="form-control t-studio-input" id="usage" [(ngModel)]="model.Usage" #usage="ngModel"
                        (ngModelChange)="onTemplateChange()">
                        <option value=""></option>
                        <option value="FromSearchAndDetails">{{ 'Template_Usage_FromSearchAndDetails' | translate }}
                        </option>
                        <option value="FromDetails">{{ 'Template_Usage_FromDetails' | translate }}</option>
                        <option value="FromReport">{{ 'Template_Usage_FromReport' | translate }}</option>
                        <option value="Standalone">{{ 'Template_Usage_Standalone' | translate }}</option>
                    </select>
                    <ng-container
                        *ngTemplateOutlet="errorsTemplate;context: { control: usage, serverErrors: model.serverErrors?.Usage }">
                    </ng-container>
                </div>

                <!-- Collection -->
                <ng-container *ngIf="showCollectionAndDefinition(model)">
                    <div class="form-group" [class.is-invalid]="invalid(collection, model.serverErrors?.Collection)">
                        <label class="small" for="collection">{{ 'Template_Collection' | translate }}</label>
                        <select class="form-control t-studio-input" id="collection" [(ngModel)]="model.Collection"
                            #collection="ngModel" (ngModelChange)="onTemplateChange()" required>
                            <option value=""></option>
                            <option *ngFor="let collection of allCollections" value="{{collection.value}}">
                                {{ collection.name() }}</option>
                        </select>
                        <ng-container
                            *ngTemplateOutlet="errorsTemplate;context: { control: collection, serverErrors: model.serverErrors?.Collection }">
                        </ng-container>
                    </div>

                    <!-- Definition -->
                    <div class="form-group" *ngIf="showDefinitionIdSelector(model)"
                        [class.is-invalid]="invalid(definitionId, model.serverErrors?.DefinitionId)">
                        <label class="small" for="definitionId">{{ 'Template_DefinitionId' | translate }}</label>
                        <select class="form-control t-studio-input" id="definitionId" [(ngModel)]="model.DefinitionId"
                            #definitionId="ngModel" (ngModelChange)="onTemplateChange()">
                            <option value=""></option>
                            <option *ngFor="let defInfo of allDefinitionIds(model)" value="{{ defInfo.value }}">
                                {{ defInfo.name() }}</option>
                        </select>
                        <ng-container
                            *ngTemplateOutlet="errorsTemplate;context: { control: definitionId, serverErrors: model.serverErrors?.DefinitionId }">
                        </ng-container>
                    </div>
                </ng-container>

                <!-- DownloadName -->
                <div class="form-group" [class.is-invalid]="invalid(downloadName, model.serverErrors?.DownloadName)">
                    <label class="small" for="downloadName">{{ 'PrintingTemplate_DownloadName' | translate }} ({{
                        'Visibility_Optional' | translate }})</label>
                    <input class="form-control t-studio-input" id="downloadName" type="text"
                        [(ngModel)]="model.DownloadName" #downloadName="ngModel" (ngModelChange)="onPreviewChange()"
                        [ngModelOptions]="{ updateOn: 'blur' }" autocomplete="off" />
                    <ng-container
                        *ngTemplateOutlet="errorsTemplate;context: { control: downloadName, serverErrors: model.serverErrors?.DownloadName }">
                    </ng-container>
                </div>

                <!-- Supports Primary Language -->
                <div class="custom-control custom-checkbox"
                    *ngIf="!!ws.settings.SecondaryLanguageId || !!ws.settings.TernaryLanguageId">
                    <input type="checkbox" class="custom-control-input" id="supportsPrimaryLanguage"
                        [(ngModel)]="model.SupportsPrimaryLanguage" (ngModelChange)="onTemplateChange()">
                    <label class="custom-control-label" for="supportsPrimaryLanguage">{{ ('PrintingTemplate_Supports' |
                        translate) + ws.primaryPostfix }}</label>
                </div>

                <!-- Supports Secondary Language -->
                <div class="custom-control custom-checkbox" *ngIf="!!ws.settings.SecondaryLanguageId">
                    <input type="checkbox" class="custom-control-input" id="supportsSecondaryLanguage"
                        [(ngModel)]="model.SupportsSecondaryLanguage" (ngModelChange)="onTemplateChange()">
                    <label class="custom-control-label" for="supportsSecondaryLanguage">{{ ('PrintingTemplate_Supports'
                        | translate) + ws.secondaryPostfix }}</label>
                </div>

                <!-- Supports Ternary Language -->
                <div class="custom-control custom-checkbox" *ngIf="!!ws.settings.TernaryLanguageId">
                    <input type="checkbox" class="custom-control-input" id="supportsTernaryLanguage"
                        [(ngModel)]="model.SupportsTernaryLanguage" (ngModelChange)="onTemplateChange()">
                    <label class="custom-control-label" for="supportsTernaryLanguage">{{ ('PrintingTemplate_Supports' |
                        translate) + ws.ternaryPostfix }}</label>
                </div>

                <!-- IsDeployed -->
                <div class="custom-control custom-checkbox mt-3">
                    <input type="checkbox" class="custom-control-input" id="isdeployed" [(ngModel)]="model.IsDeployed">
                    <label class="custom-control-label" for="isdeployed">{{ 'Template_IsDeployed' | translate }}</label>
                </div>
            </div>
        </div>

        <!-- Collapsed Editor -->
        <div class="p-2 t-dark t-text-whitish t-collapsed-studio-pane t-pointer" *ngIf="isEdit && collapseEditor"
            (click)="onToggleEditor()">
            <div class="text-center mb-3">
                <fa-icon icon="angle-right" [flip]="flipIcon(false)"></fa-icon>
            </div>
            <span>{{ 'Editor' | translate }}</span>
        </div>

        <div class="h-100 d-flex flex-grow-1">

            <!-- Editor -->
            <div class="t-less-dark h-100 t-studio-pane flex-column p-0 col-4" *ngIf="isEdit"
                [class.d-flex]="!collapseEditor" [class.d-none]="collapseEditor">

                <!-- Editor Header -->
                <div class="py-2 px-3 t-dark t-text-whitish d-flex justify-content-between t-pointer"
                    (click)="onToggleEditor()">
                    <span>{{ 'Editor' | translate }}</span>
                    <div class="text-center">
                        <fa-icon icon="angle-left" [flip]="flipIcon(false)"></fa-icon>
                    </div>
                </div>

                <!-- Editor Content -->
                <div class="flex-grow-1 d-flex flex-column">
                    <input class="form-control t-studio-input t-code" id="context" type="text" [(ngModel)]="model.Context"
                        #context="ngModel" (ngModelChange)="onPreviewChange()" [ngModelOptions]="{ updateOn: 'blur' }"
                        autocomplete="off" placeholder="{{ 'PrintingTemplate_Context' | translate }} ({{ 'Visibility_Optional' | translate }})" />
                    <ng-container
                        *ngTemplateOutlet="errorsTemplate;context: { control: context, serverErrors: model.serverErrors?.Context }">
                    </ng-container>
                    <textarea class="w-100 t-rest-of-screen form-control t-studio-input text-nowrap border-0 t-code"
                        spellcheck="false" [(ngModel)]="model.Body" (ngModelChange)="onPreviewChange()" #textarea
                        (keydown)="onKeydown(textarea, $event, model)"></textarea>
                    <!-- <ace class="w-100 h-100" [config]="config" [value]="model.Body"
                        (valueChange)="onAceValueChange($event, model)"></ace> -->
                </div>
            </div>

            <!-- Preview Section -->
            <div class="d-flex flex-column p-0" [class.col-8]="isEdit && !collapseEditor"
                [class.col-12]="!(isEdit && !collapseEditor)">
                <!-- Header -->
                <div class="t-dark t-text-whitish d-flex justify-content-between" *ngIf="isEdit">
                    <div class="p-2 px-3">
                        <span>{{ 'Preview' | translate }}</span>&nbsp;&nbsp;
                    </div>
                </div>

                <div class="col d-flex flex-column t-rest-of-screen bg-white">
                    <t-print [template]="template(model)" [preview]="preview(model)">
                    </t-print>
                </div>
            </div>
        </div>
    </div>
</ng-template>


<ng-template #errorsTemplate let-control="control" let-serverErrors="serverErrors">
    <ng-container *ngIf="invalid(control, serverErrors)">
        <span class="small t-light-danger" *ngFor="let e of errors(control, serverErrors)">
            {{ e() }}
        </span>
    </ng-container>
</ng-template>